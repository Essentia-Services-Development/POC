!function s(i,a,n){function r(t,e){if(!a[t]){if(!i[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(p)return p(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}o=a[t]={exports:{}},i[t][0].call(o.exports,function(e){return r(i[t][1][e]||e)},o,o.exports,s,i,a,n)}return a[t].exports}for(var p="function"==typeof require&&require,e=0;e<n.length;e++)r(n[e]);return r}({1:[function(s,e,t){!function(o){!function(){"use strict";var e,f=s("./datetime"),v="undefined"!=typeof window?window.peepsodata:void 0!==o?o.peepsodata:null;function t(){this.current_post=null,this.is_ajax_loading={},this.is_editing={}}t.prototype.init=function(){var t=this;this.$post_container=jQuery("#ps-activitystream"),jQuery(".ps-js-comment-container").each(function(e,t){0===jQuery("div",t).length&&jQuery(this).hide()}),jQuery(".cstream-respond").each(function(e,t){0===jQuery("div",t).not(".ps-js-comment-container").length&&jQuery(this).hide(),jQuery("textarea[name=comment]",t).ps_autosize()}),jQuery(document).on("click",".ps-js-content-excerpt-toggle",function(e){var t=jQuery(e.currentTarget);if(!t.data("single-act"))return e.preventDefault(),e.stopPropagation(),(e=t.closest(".ps-js-content-excerpt")).length&&e.hide().siblings(".ps-js-content-full").show(),!1}),jQuery(document).on("ps_activitystream_loaded peepso_repost_shown peepso_report_shown ps_activitystream_append",function(e){t.setup_comment_textarea(),t.update_pinned_color(),t.parseXFBML()}),jQuery(document).on("ps_comment_save",function(){t.setup_comment_textarea()}),jQuery(document).trigger("ps_activitystream_loaded"),jQuery(document).on("ps_comment_addon_added ps_comment_addon_removed",function(e,t){var o,s=(o=(t=jQuery(t)).closest(".ps-js-addons")).closest(".ps-textarea-wrapper").find("textarea");"ps_comment_addon_added"===e.type?(t.siblings().hide(),o.show()):"ps_comment_addon_removed"===e.type&&(t.siblings(":visible").length?o.show():o.hide()),s.trigger("input")}),peepso.observer.addAction("peepso_delete_post",function(){peepsodata.activity&&+peepsodata.activity.is_permalink&&window.location.reload()})},t.prototype.setup_comment_textarea=function(){jQuery('[data-type="stream-newcomment"] textarea').off("keyup.peepso").on("keyup.peepso",jQuery.proxy(function(e){e.stopPropagation(),this.update_beautifier(e.target)},this))},t.prototype.update_beautifier=_.throttle(function(i){_.defer(_.bind(function(){var e,t,o=jQuery(i),s=o.data("ps-beautifier");s||(o.addClass("ps-tagging-textarea"),(t=o.parent(".ps-postbox__input-tag")).length||(o.wrap("<div class=ps-postbox__input-tag />"),t=o.parent(".ps-postbox__input-tag")),(s=t.children(".ps-postbox__input-beautifier")).length||(s=jQuery("<div class=ps-postbox__input-beautifier />")).prependTo(t),o.data("ps-beautifier",s),o.focus()),(t=window._wpemojiSettings||{})&&t.supports&&(t.supports.everything=!0),e=o.val()||"",e=(e=peepso.observer.applyFilters("peepso_postbox_beautifier",e,o)).replace(/<(?!\/?ps_)/g,"&lt;").replace(/<(\/?)ps_/g,"<$1").replace(/\r?\n/g,"<br />"),s.html(e)},this))},100),t.prototype.action_like=function(e,t){var o,s,i,a;return this.action_like_progress||(this.action_like_progress=!0,o={act_id:t,uid:peepsodata.currentuserid},s=this,i=jQuery(e),a=jQuery(".ps-js-act-like--"+t),e=i.hasClass("liked"),e=+a.data("count")+(e?-1:1),a.html(),i.toggleClass("liked"),e<1?a.hide():(1==e?a.html('<a href="#" onclick="return activity.show_likes('+t+');">1 '+peepsodata.like_text+"</a>"):a.html('<a href="#" onclick="return activity.show_likes('+t+');">'+e+" "+peepsodata.like_text_plural+"</a>"),a.show()),peepso.postJson("activity.like",o,function(e){s.action_like_progress=!1,e.success?(i.replaceWith(e.data.like_html),a.data("count",e.data.count),0<e.data.count?a.html(e.data.count_html).show():a.hide()):(psmessage.show("",e.errors[0]).fade_out(psmessage.fade_time),i.toggleClass("liked"),a.html(html),1<=+a.data("count")?a.show():a.hide())})),!1},t.prototype.action_repost=function(t,e){var o,s,i,a,n={act_id:t,uid:peepsodata.currentuserid,user_id:peepsodata.userid},r=peepsodata.activity&&peepsodata.activity.template_repost?jQuery(peepsodata.activity.template_repost):jQuery("#repost-dialog");return e instanceof Element&&(this._action_repost_button=e),e=r.find(".dialog-title").html(),o=jQuery("#ajax-loader-gif").html(),pswindow.show(e,o),peepso.postJson("activity.ajax_show_post",n,function(e){0==e.success?pswindow.hide():(o=r.find(".dialog-content").html(),s=r.find(".dialog-action").html(),i=(i=e.data.html.trim()).replace("<p>","<span>").replace("</p>","<br/></span>").replace("<br/></span>","</span>"),a=jQuery("<div/>").append('<blockquote class="ps-js-activity-quote">'+i+"</blockquote>"),a=peepso.observer.applyFilters("peepso_activity",a),i=peepso.observer.applyFilters("peepso_activity_content",a.children().html()),o=(o=o.replace("{post-content}",i)).replace("{post-id}",t+""),pswindow.set_content(o).set_actions(s).refresh(),jQuery(document).trigger("peepso_repost_shown"),jQuery("#share-post-box","#ps-window").autosize(),jQuery("#ps-window").find(".ps-js-dropdown-menu").css({left:0,right:"auto"}))}),!1},t.prototype.submit_repost=function(){var n=jQuery("#postbox-post-id","#ps-window").val(),e={content:jQuery("#share-post-box","#ps-window").val(),id:peepsodata.currentuserid,uid:peepsodata.currentuserid,repost:n,acc:jQuery("#cWindowContent input[name='repost_acc']").val(),type:"activity"},e=peepso.observer.applyFilters("postbox_req",e);return peepso.postJson("postbox.post",e,function(e){var t,o,s,i,a;e.success&&(pswindow.hide(),0!=+peepsodata.userid&&+peepsodata.currentuserid!=+peepsodata.userid||(e=peepso.observer.applyFilters("peepso_activity_content",e.data.html),t=peepso.observer.applyFilters("peepso_activity",jQuery(e)),o=jQuery("html, body"),(s=jQuery("#ps-activitystream").find(".ps-js-activity").filter('[data-id="'+n+'"]')).length&&(i=s.offset().top,a=o.scrollTop(),setTimeout(function(){i=s.offset().top-i,o.scrollTop(a+i)},1)),t.prependTo("#ps-activitystream"),jQuery(document).trigger("peepso_repost_added"),activity._action_repost_button&&((e=jQuery(activity._action_repost_button)).find("span").html(peepsodata.label_done).css("color","green"),e.removeAttr("onclick"),e.off("click").on("click",function(e){e.preventDefault(),e.stopPropagation(),jQuery("html, body").animate({scrollTop:t.offset().top-20})}),activity._action_repost_button=null)))}),!1},t.prototype.action_report=function(s){var e={act_id:s,uid:peepsodata.currentuserid,user_id:peepsodata.userid},t=jQuery("#activity-report-title").html(),o=jQuery("#ajax-loader-gif").html();pswindow.show(t,o),peepso.postJson("activity.ajax_show_post",e,function(e){var t=jQuery("#activity-report-content").html(),e=(e=e.data.html.trim()).replace("<p>","<span>").replace("</p>","<br/></span>").replace("<br/></span>","</span>"),e=(t=(t=t.replace("{post-content}",e)).replace("{post-id}",s+""),jQuery("#activity-report-actions").html()),o=(pswindow.set_content(t).set_actions(e).refresh(),jQuery("#cWindowContent .ps-js-report-desc"));o.find("textarea").off("input").on("input",_.throttle(function(e){o.find(".ps-js-counter").html(e.target.value.length)},500)).triggerHandler("input"),jQuery(document).trigger("peepso_report_shown")})},t.prototype.submit_report=function(){var e,t=jQuery("#cWindowContent .ps-js-report-error").hide(),o=jQuery("#cWindowContent select.ps-js-report-type"),s=jQuery("#cWindowContent .ps-js-report-desc textarea"),i=o.val(),s=s.val().trim();return i?o.find("option:selected").data("needReason")&&!s?(e=jQuery("#report-error-empty-reason").text(),t.text(e).show()):(o=jQuery("#postbox-report-popup #postbox-post-id","#ps-window").val(),o=peepso.observer.applyFilters("activity_report_params",{act_id:o,uid:peepsodata.currentuserid,reason:i,reason_desc:s}),i=peepso.observer.applyFilters("activity_report_action","activity.report"),peepso.postJson(i,o,function(e){e.success?(jQuery(window).trigger("report.submitted",e),pswindow.set_content(e.notices[0]).fade_out(pswindow.fade_time)):(pswindow.hide(),psmessage.show("",e.errors[0]).fade_out(psmessage.fade_time))})):(e=jQuery("#report-error-select-reason").text(),t.text(e).show()),!1},t.prototype.action_delete=function(s,t,e){return pswindow.confirm_delete(jQuery.proxy(function(){var e=jQuery.extend({uid:peepsodata.currentuserid,postid:s,_wpnonce:peepsodata.peepso_nonce},t||{});pswindow.hide(),peepso.postJson("activity.delete",e,jQuery.proxy(function(e){var t,o;this.toggle_comment_box(s,!1),e.success&&(o=jQuery("#ps-activitystream-recent"),(t=jQuery(".ps-js-activity").filter('[data-post-id="'+s+'"]')).length?(t.css({transition:"opacity .5s","-webkit-transition":"opacity .5s"}),setTimeout(function(){t.css("opacity",0),setTimeout(function(){t.slideUp(function(){t.remove(),o.children().length||o.hide(),peepso.observer.doAction("peepso_delete_post",s)})},700)},0)):peepso.observer.doAction("peepso_delete_post",s))},this))},this),e),!1},t.prototype.action_pin=function(e,t,o){e={postid:e,uid:peepsodata.currentuserid,pinstatus:t,pinuntil:o};return peepso.ajax.post("activity.pin",e,-1).done(e=>{e.success&&window.location.reload()}),!1},t.prototype.action_pin_dialog=function(e){var t=v.datetime&&v.datetime.text.monthNames,o=v.datetime&&v.datetime.text.am,s=v.datetime&&v.datetime.text.pm,i=peepsodata.activity&&peepsodata.activity.template_pin||"";let a=peepso.dialog(i).show();var i=a.$el.find(".ps-js-date-dd"),n=a.$el.find(".ps-js-date-mm"),r=a.$el.find(".ps-js-date-yy"),p=a.$el.find(".ps-js-time-hh"),c=a.$el.find(".ps-js-time-mm"),d=a.$el.find(".ps-js-time-ampm");let u=+c.data("interval")||15;var l=new Date,m=new Date,h=(m.setFullYear(Math.max(2035,m.getFullYear()+1)),()=>{var e=new Date,t=y.getDate().split("-"),o=_.getTime().split(":"),t=new Date(+t[0],+t[1]-1,+t[2],+o[0],+o[1]);e.setHours(e.getHours()+1,e.getMinutes()+(u-e.getMinutes()%u),0),t<e&&_.setTime(e.getHours()+":"+e.getMinutes())}),o={step:u,am:o,pm:s,onSelect:h};let y=new f.DateSelector(r[0],n[0],i[0],{monthNames:t,minDate:l,maxDate:m,onSelect:h}),_=new f.TimeSelector(p[0],c[0],d.length?d[0]:o,d.length?o:void 0);return h(),a.$el.find("form").on("submit",e=>e.preventDefault()),a.$el.find(".ps-js-cancel").on("click",()=>a.hide()),a.$el.find(".ps-js-submit").on("click",()=>{this.action_pin(e,1,y.getDate()+" "+_.getTime()),a.hide()}),!1},t.prototype.action_nsfw=function(t,e){e={postid:t,uid:peepsodata.currentuserid,nsfw_status:e};peepso.ajax.post("activity.nsfw",e,-1).done(e=>{e.success&&this.reload(t)})},t.prototype.action_remove_link_preview=function(e,t){t=jQuery(".ps-js-activity--"+t);t.length&&(t.find(".ps-js-post-body .js-stream-attachments").children(".ps-media").remove(),t.find(".js-stream-actions .actaction-removepreview").remove(),t.find(".ps-js-post-body .ps-js-activity-content .ps-js-hide-url").show(),t.find(".ps-js-post-header .ps-js-btn-remove-preview").hide(),peepso.postJson("activity.remove_link_preview",{postid:e,uid:peepsodata.currentuserid}))},t.prototype.on_commentbox_change=_.debounce(function(e){var t,o,s=jQuery(e),i=s.val(),a=(i.length>peepsodata.postsize&&(i=i.substring(0,peepsodata.postsize),s.val(i)),n=s,a=i.length,r=peepsodata.postsize,(t=n.parent().siblings(".ps-js-char-count")).length||(t=jQuery('<div class="ps-form__chars-count ps-js-char-count"></div>')).appendTo(n.parent().parent()),o=a/r,r-=a,!n.val().trim()||o<.5?t.hide():(t.html(r),t.css("color",.9<o?"red":.75<o?"orange":""),t.show()),""===i.trim()),n=peepso.observer.applyFilters("comment_show_button",{el:s,show:!a}),r=s.parents(".cstream-form-input").next(".ps-comments__reply-send");n.show?(r.show().find(".ps-comment-actions").show(),r.find(".ps-button-action").removeAttr("disabled"),void 0===this.__originalBeforeOnload&&(this.__originalBeforeOnload=window.onbeforeunload||function(){},window.onbeforeunload=function(e){e.preventDefault(),e.returnValue=""})):(r.find(".ps-button-action").attr("disabled","disabled"),void 0!==this.__originalBeforeOnload&&(window.onbeforeunload=this.__originalBeforeOnload,this.__originalBeforeOnload=void 0)),s.is(":focus")||this.on_commentbox_blur(e)},100),t.prototype.on_commentbox_focus=function(e){clearTimeout(e.onblur_timer);var e=jQuery(e).parents(".cstream-form-input"),t=e.next(".ps-comments__reply-send");e.find(".ps-js-actions").show(),t.show().find(".ps-comment-actions").show()},t.prototype.on_commentbox_blur=function(o){clearTimeout(o.onblur_timer),o.onblur_timer=setTimeout(function(){var e=jQuery(o),t=e.val().trim();t||peepso.observer.applyFilters("comment_show_button",{el:e,show:""!==t}).show||(e=(t=e.parents(".cstream-form-input")).next(".ps-comments__reply-send"),t.find(".ps-js-actions").css("display",""),e.css("display","").find(".ps-comment-actions").css("display",""))},100)},t.prototype.comment_save=function(o,e){var s,i,a,n;if(!this.is_ajax_loading["save-comment-"+o])return s=this,i=jQuery("#act-new-comment-"+o+" .cstream-form-text"),e&&e.tagName&&(i=jQuery(e).closest("#act-new-comment-"+o).find(".cstream-form-text")),jQuery("#act-new-comment-"+o+" .ps-js-actions").hide(),jQuery("#act-new-comment-"+o+" .ps-comment-actions").hide(),jQuery("#act-new-comment-"+o+" .ps-comment-loading").show(),e=(a=jQuery(i)).val(),n=peepso.observer.applyFilters("comment_req",{act_id:o,uid:peepsodata.currentuserid,content:e,last:jQuery(".ps-js-comment-container[data-act-id="+o+"] .cstream-comment:last").data("comment-id")},i),jQuery(document).trigger("ps_comment_beforesave",[o,i]),this.is_ajax_loading["save-comment-"+o]=!0,a.attr("disabled","disabled"),peepso.postJson("activity.makecomment",n,function(e){var t;s.is_ajax_loading["save-comment-"+o]=!1,a.removeAttr("disabled"),e.success?(t=jQuery("<div />").append(e.data.html),t=peepso.observer.applyFilters("peepso_activity",t),t=peepso.observer.applyFilters("peepso_activity_content",t.html()),t=jQuery(t),jQuery(".ps-js-comment-container[data-act-id="+o+"]").show(),t.appendTo(".ps-js-comment-container[data-act-id="+o+"]").hide().fadeIn(2e3),jQuery("#peepso-wrap").trigger("comment.saved",[o,i,n,t]),jQuery(document).trigger("ps_comment_save"),t.find(".ps-js-comment-body input[name=peepso_set_human_friendly]").each(function(){var e=jQuery(this),t=e.siblings(".ps-js-comment-content"),o=t.closest(".ps-js-comment");!+peepsodata.is_admin&&+e.data("author")!=+peepsodata.currentuserid||(t=t[0].innerText.trim(),(o=peepso.observer.applyFilters("human_friendly_extras",[],t,o[0])).length&&(t&&o.unshift(t),t=o.join(". ")),t=t.replace(/\r?\n/g," "),peepso.modules.post.setHumanReadable(e.val(),t))}),(t=t.filter(".ps-js-comment-item")).length&&peepso.hooks.doAction("comment_added",t[0])):psmessage.show("",e.errors[0]).fade_out(psmessage.fade_time),jQuery(document).trigger("ps_comment_aftersave",[o,i]),activity.comment_cancel(o),activity.current_post=null,jQuery("#act-new-comment-"+o+" .ps-js-actions").css("display",""),jQuery("#act-new-comment-"+o+" .ps-comment-loading").hide(),jQuery("#act-new-comment-"+o+" .ps-comment-actions").css("display",""),jQuery("#act-new-comment-"+o+" .ps-button-action").attr("disabled","disabled"),void 0!==e.data.has_max_comments&&s.toggle_comment_box(o,e.data.has_max_comments)}),!1},t.prototype.comment_action_edit=function(t,e){var o,s;if(!(0<jQuery("#comment-item-"+t+" .js-stream-content .cstream-edit").length))return o=this,s=jQuery(e).closest("#comment-item-"+t),void 0!==this.is_ajax_loading["comment-edit-"+t]&&!1!==this.is_ajax_loading["comment-edit-"+t]||(this.is_ajax_loading["comment-edit-"+t]=!0,e={postid:t,uid:peepsodata.currentuserid},peepso.postJson("activity.editcomment",e,function(e){e.success&&(e=jQuery(e.data.html),jQuery("[data-type='stream-comment-content']",s).first().hide().after(e),jQuery(".ps-comment-media",s).hide(),jQuery("#peepso-wrap").trigger("comment_edit.shown",[t,e]),peepso.observer.doAction("comment_edit",t,e),jQuery(".cstream-edit textarea",s).on("input propertychange",function(){jQuery(this).val().length>peepsodata.postsize&&jQuery(this).val(jQuery(this).val().substring(0,peepsodata.postsize))}).autosize().off("keyup.peepso").on("keyup.peepso",function(e){e.stopPropagation(),activity.update_beautifier(e.target)}).trigger("keyup.peepso"),o.is_ajax_loading["comment-edit-"+t]=!1)})),!1},t.prototype.option_canceleditcomment=function(e,t){t=jQuery(t).closest("#comment-item-"+e);return 0<t.length&&(jQuery(".cstream-edit",t).remove(),jQuery("[data-type='stream-comment-content']",t).show(),jQuery(".ps-comment-media",t).show()),void 0!==this.__originalBeforeOnload&&(window.onbeforeunload=this.__originalBeforeOnload,this.__originalBeforeOnload=void 0),!1},t.prototype.option_savecomment=function(s,e){var t,i=jQuery(e).closest("#comment-item-"+s);return 0<i.length&&(e=jQuery(".cstream-edit textarea",i).val(),jQuery(".cstream-edit textarea",i).attr("disabled","disabled"),jQuery(".ps-edit-loading",i).show(),jQuery(".cstream-edit button",i).hide(),t=jQuery(".cstream-edit textarea",i),e=peepso.observer.applyFilters("comment_req",{postid:s,uid:peepsodata.currentuserid,post:e},t),jQuery(document).trigger("ps_comment_beforesave",[s,t]),peepso.postJson("activity.savecomment",e,e=>{var t,o;e.success?(jQuery(".cstream-edit",i).remove(),t=jQuery("<div />").append(e.data.html),t=peepso.observer.applyFilters("peepso_activity",t),t=peepso.observer.applyFilters("peepso_activity_content",t.html()),jQuery("[data-comment-id="+s+"] [data-type='stream-comment-content']").html(t),jQuery("[data-type='stream-comment-content']",i).show(),t=e.data.attachments||"",o=i.find(".ps-js-btn-remove-preview"),jQuery("[data-comment-id="+s+"]").find(".ps-js-comment-body .ps-js-comment-attachment").html(t),t?o.show():o.hide(),jQuery(".js-stream-content > .js-stream-attachments",i).show(),jQuery("span.ps-stream-status-action",i).html(e.data.actions),jQuery(document).trigger("ps_comment_save"),peepso.hooks.doAction("comment_updated",i[0]),void 0!==this.__originalBeforeOnload&&(window.onbeforeunload=this.__originalBeforeOnload,this.__originalBeforeOnload=void 0)):(psmessage.show("",e.notices[0]),jQuery(".cstream-edit button",i).show(),jQuery(".ps-edit-loading",i).hide(),jQuery(".cstream-edit textarea",i).removeAttr("disabled"))})),!1},t.prototype.comment_action_delete=function(o){var s=this;pswindow.confirm_delete(function(){var e={postid:o,uid:peepsodata.currentuserid,_wpnonce:peepsodata.peepso_nonce};return peepso.postJson("activity.delete",e,function(e){var t;s.toggle_comment_box(o,!1),e.success&&(t=(e=jQuery(".ps-comment-item[data-comment-id="+o+"]")).next('[class*="ps-js-comment-reply--"]'),e.remove(),t.remove()),pswindow.hide()}),!1})},t.prototype.comment_action_remove_preview=function(e){var t=jQuery("#comment-item-"+e);return t.length&&(t.find(".ps-comment-media").children(".ps-media--iframe, .ps-media--embed").remove(),t.find(".ps-comment__content .ps-js-hide-url").show(),t.find(".ps-js-btn-remove-preview").hide(),peepso.postJson("activity.remove_link_preview",{postid:e,uid:peepsodata.currentuserid})),!1},t.prototype.comment_action_report=function(i){return peepso.postJson("activity.ajax_show_comment",{act_id:i},function(e){var t=jQuery("#activity-report-title").html(),o=jQuery("#activity-report-content").html(),e=(e=e.data.html.trim()).replace("<p>","<span>").replace("</p>","<br/></span>").replace("<br/></span>","</span>"),s=(o=(o=o.replace("{post-content}",e)).replace("{post-id}",i+""),peepso.observer.addFilter("activitystream_notice_container",function(e,t){return"#comment-item-"+t+" .cstream-more"},10,2),actions=jQuery("#activity-report-actions").html(),pswindow.show(t,o).set_actions(actions).refresh(),jQuery("#cWindowContent .ps-js-report-desc"));s.find("textarea").off("input").on("input",_.throttle(function(e){s.find(".ps-js-counter").html(e.target.value.length)},500)).triggerHandler("input"),jQuery("#ps-window").one("pswindow.hidden",function(){peepso.observer.removeFilter("activitystream_notice_container",function(e,t){return"#comment-item-"+t+" .cstream-more"},10)})}),!1},t.prototype.comment_action_reply=function(e,t,o,s){return peepso.comment.reply(e,t,o,s),!1},t.prototype.comment_action_like=function(e,t){var o,s,i,a;if(!this.comment_action_like_progress)return this.comment_action_like_progress=!0,o={act_id:t,uid:peepsodata.currentuserid},s=this,i=jQuery(e),a=jQuery(".ps-js-act-like--"+t),e=i.hasClass("liked"),e=+a.data("count")+(e?-1:1),a.html(),i.toggleClass("liked"),e<1?a.hide():(1==e?a.html('<a href="#" onclick="return activity.show_likes('+t+');">1 '+peepsodata.like_text+"</a>"):a.html('<a href="#" onclick="return activity.show_likes('+t+');">'+e+" "+peepsodata.like_text_plural+"</a>"),a.show()),peepso.postJson("activity.like",o,function(e){s.comment_action_like_progress=!1,e.success?(i.replaceWith(e.data.like_html),a.data("count",e.data.count),0<e.data.count?a.html(e.data.count_html).show():a.hide()):(psmessage.show("",e.errors[0]).fade_out(psmessage.fade_time),i.toggleClass("liked"),a.html(html),1<=+a.data("count")?a.show():a.hide())}),!1},t.prototype.comment_cancel=function(e){var e=jQuery("div#act-new-comment-"+e),t=e.find(".cstream-form-text");return e.find(".ps-comments__reply-send").hide(),e.find(".ps-js-commentbox-addons").hide(),t.val("").trigger("autosize.resize"),peepso.observer.applyFilters("comment_cancel",t),!1},t.prototype.show_likes=function(t){var e={act_id:t,uid:peepsodata.currentuserid},o=this,s="likes-"+t;return this.is_ajax_loading[s]&&(this.is_ajax_loading[s].ret&&this.is_ajax_loading[s].ret.abort(),this.is_ajax_loading[s]=!1),this.is_ajax_loading[s]=peepso.postJson("activity.get_like_names",e,function(e){jQuery("#act-like-"+t+" a").replaceWith(e.data.html),o.is_ajax_loading[s]=!1}),!1},t.prototype.show_comments=function(e,t){return peepso.comment.show_previous(e,t),!1},t.prototype.option_edit=function(e,o){return new Promise(s=>{var i,a,n,r,p,c,d,u="edit-post-"+o;this.is_editing[u]?s():(this.is_editing[u]=!0,i=jQuery(".ps-js-activity--"+o),a=i.find(".ps-js-activity-content"),n=i.find(".ps-js-activity-edit"),r=i.find(".js-stream-actions"),p=i.find(".ps-js-post-body .ps-js-activity-attachments"),c=i.find(".ps-js-activity-extras"),d=i.find(".ps-js-post-nsfw"),n.ps_postbox({fetch:function(t,o){peepso.postJson("activity.editpost",{uid:peepsodata.currentuserid,postid:e},function(e){e.success&&(t.update(e.data),t.$text.off("keyup.peepso").on("keyup.peepso",function(e){e.stopPropagation(),activity.update_beautifier(e.target)}).trigger("keyup.peepso")),o(),s()})},cancel:jQuery.proxy(function(e){this.is_editing[u]=!1,n.ps_postbox("destroy"),a.show(),d.show()},this),submit:jQuery.proxy(function(e,t,s){(t=jQuery.extend({},t,{uid:peepsodata.currentuserid,act_id:o})).post=t.content,delete t.content,peepso.postJson("activity.savepost",t,jQuery.proxy(function(e){var t,o;e.success?(this.is_editing[u]=!1,n.ps_postbox("destroy"),t=jQuery("<div />").append(e.data.html),t=peepso.observer.applyFilters("peepso_activity",t),t=peepso.observer.applyFilters("peepso_activity_content",t.html()),a.html(t).show(),d.show(),r.html(e.data.actions),c.html(e.data.extras||""),e.data&&e.data.timestamp&&i.find(".ps-js-post-header .ps-js-timestamp").html(e.data.timestamp),t=e.data.attachments||"",o=i.find(".ps-js-post-header .ps-js-btn-remove-preview"),p.html(t),t?o.show():o.hide(),peepso.observer.doAction("peepso_activity_actions",r),peepso.hooks.doAction("post_updated",i[0])):psmessage.show("",e.errors[0]),jQuery(document).trigger("peepso_post_edit_saved"),s()},this))},this)}),a.hide(),n.show(),d.hide())})},t.prototype.option_canceledit=function(e){this.is_editing["edit-post-"+e]=!1;e=jQuery(".ps-js-activity--"+e);return 0<e.length&&(jQuery(".cstream-edit",e).remove(),jQuery(".cstream-attachment",e).show()),!1},t.prototype.option_cancel_edit_description=function(e){e=jQuery(".ps-js-modal-attachment--"+e);return 0<e.length&&(jQuery(".cstream-edit",e).remove(),jQuery(".cstream-attachment",e).show()),!1},t.prototype.option_savepost=function(t){var e,o=jQuery(".ps-js-activity--"+t);return 0<o.length&&(e=jQuery(".cstream-edit textarea",o).val(),jQuery(".cstream-edit textarea",o).attr("disabled","disabled"),jQuery(".ps-edit-loading",o).show(),jQuery(".cstream-edit button",o).hide(),e=peepso.observer.applyFilters("postbox_req_edit",{act_id:t,uid:peepsodata.currentuserid,post:e},jQuery(".cstream-edit textarea",o)),peepso.postJson("activity.savepost",e,jQuery.proxy(function(e){jQuery(".cstream-edit",o).remove(),e.success?(this.is_editing["edit-post-"+t]=!1,jQuery(".ps-stream-body .cstream-attachment",o).html(e.data.html),jQuery(".ps-stream-body .cstream-attachments",o).html(e.data.attachments),jQuery(".js-stream-actions",o).html(e.data.actions)):psmessage.show("",e.errors[0]),jQuery(".ps-stream-body .cstream-attachment, .ps-stream-body .cstream-attachments",o).show(),jQuery(document).trigger("peepso_post_edit_saved")},this))),!1},t.prototype.option_save_description=function(e,t,o){var s,i,a=jQuery(".ps-js-modal-attachment--"+e);return 0<a.length&&(i=(s=jQuery(".cstream-edit textarea",a)).val(),jQuery(".cstream-edit textarea",a).attr("disabled","disabled"),jQuery(".ps-edit-loading",a).show(),jQuery(".cstream-edit button",a).hide(),e={act_id:e,type:t,object_id:o,uid:peepsodata.currentuserid,description:i},e=peepso.observer.applyFilters("caption_req",e,s),peepso.postJson("activity.save_description",e,function(e){e=jQuery("<div />").append(e.data.html),e=peepso.observer.applyFilters("peepso_activity",e),e=peepso.observer.applyFilters("peepso_activity_content",e.html());jQuery(".cstream-edit",a).remove(),jQuery(".ps-stream-attachment",a).html(e).show()})),!1},t.prototype.option_block=function(t,e){e={uid:peepsodata.currentuserid,user_id:e};return peepso.postJson("activity.blockuser",e,function(e){e.success?jQuery(".ps-js-activity--"+t).remove():e.errors&&alert(e.errors[0])}),!1},t.prototype.option_enable_comments=function(t){var o=this;return peepso.postJson("activity.set_comments_status",{post_id:t,open:1},function(e){e.success?(o.reload(t),peepso.observer.doAction("comments_enable",t)):e.errors&&alert(e.errors[0])}),!1},t.prototype.option_disable_comments=function(t){var o=this;return peepso.postJson("activity.set_comments_status",{post_id:t,open:0},function(e){e.success?(o.reload(t),peepso.observer.doAction("comments_disable",t)):e.errors&&alert(e.errors[0])}),!1},t.prototype.reload=function(s){var e={uid:peepsodata.currentuserid,user_id:peepsodata.userid,post_id:s,context:"single",page:1,pinned:1},e=peepso.observer.applyFilters("postbox_req",e);return peepso.postJson("activity.show_posts_per_page",e,function(e){var e=e&&e.data||{},t=jQuery(`.ps-js-activity[data-post-id="${s}"]`),o=jQuery(e.posts);(o=peepso.observer.applyFilters("peepso_activity",o)).find(".ps-js-activity-content, .ps-comment-item, .ps-stream-quote").each(function(){var e=jQuery(this),t=e.html(),t=peepso.observer.applyFilters("peepso_activity_content",t);e.html(t)}),t.replaceWith(o),peepso.hooks.doAction("post_reload",s,e),setTimeout(function(){jQuery(document).trigger("ps_activitystream_loaded"),jQuery("textarea[name=comment]",o).ps_autosize()},1)}),!1},t.prototype.change_post_privacy=function(e,t){var o,s,i,a,n,r="[class*=gci-]";return e=jQuery(e),n=jQuery(".ps-js-privacy--"+t),o=n.find(".ps-js-dropdown-toggle"),s=o.find(r).attr("class"),n=e.find(r).attr("class"),i=o.find(r).next("span").text(),a=e.find(r).next("span").text(),o.find(r).attr("class",n),o.find(r).next("span").text(a),o.css("opacity",.5),(n=this.change_post_privacy)._xhr||(n._xhr={}),n._xhr[t]&&n._xhr[t].ret.abort(),n._xhr[t]=peepso.postJson("activity.change_post_privacy",{uid:peepsodata.currentuserid,user_id:peepsodata.userid,act_id:t,acc:e.data("option-value"),_wpnonce:peepsodata.peepso_nonce},function(e){o.css("opacity",""),e.has_errors&&(o.find(r).attr("class",s),o.find(r).next("span").text(i),psmessage.show("",e.errors[0]).fade_out(psmessage.fade_time))}),!1},t.prototype.toggle_comment_box=function(e,t){var o,s=jQuery("#act-new-comment-"+e);return s.length<=0&&0<(o=(o=jQuery("#comment-item-"+e)).length<=0?jQuery(".ps-js-activity--"+e):o).length&&(s=o.parent(),e=(o.parent().attr("id")+"").split("-").pop(),s=jQuery("#act-new-comment-"+e)),s.length<=0||(t?s.hide():s.show()),!1},t.prototype.delete_activity=function(e,t){var o=jQuery.extend({act_id:e,uid:peepsodata.currentuserid,_wpnonce:jQuery("#_delete_nonce").val()},t||{}),t=jQuery("[data-act-delete-id="+e+"]"),e="";return 0<t.length&&(e=t.text()),pswindow.confirm_delete(function(){peepso.postJson("activity.ajax_delete_activity",o,function(e){e.success?window.location.reload():psmessage.show("",e.errors[0]).fade_out(psmessage.fade_time)})},e),!1},t.prototype.edit_activity_description=function(e,t,o){var s=jQuery(".ps-js-modal-attachment--"+e);if(!(0<s.find(".cstream-edit textarea").length))return s.length&&s.is(":hidden")&&s.closest(".ps-lightbox").find(".ps-lightbox-data-toggle").trigger("click"),e={act_id:e,type:t,object_id:o,uid:peepsodata.currentuserid},this.edit_activity_description_xhr&&this.edit_activity_description_xhr.ret&&this.edit_activity_description_xhr.ret.abort(),this.edit_activity_description_xhr=peepso.postJson("activity.edit_description",e,function(e){var t;e.success&&(t=jQuery(e.data.html),s.find(".ps-stream-attachment").first().hide().after(t),jQuery("#peepso-wrap").trigger("post_edit.shown",[e.data.act_id,t]),s.find(".cstream-edit textarea").on("input propertychange",function(){jQuery(this).val().length>peepsodata.postsize&&jQuery(this).val(jQuery(this).val().substring(0,peepsodata.postsize))}).autosize().focus())}),!1},t.prototype.remove_broken_thumbnails=function(){jQuery(".ps-media-thumbnail img").each(function(){var e=new Image,t=this;e.onerror=function(){jQuery(t).closest(".ps-media-thumbnail").remove()},e.src=t.src})},t.prototype.update_pinned_color=_.debounce(function(){var e,t,o,s,i,a=jQuery(".ps-stream__post-pin span"),n=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/;a.length&&(e=a.eq(0).closest(".ps-stream").find("a").eq(0).css("color"),t=a.css("color"),a.css("backgroundColor",e),e=e.match(n),t=t.match(n),e)&&t&&(o=[+e[1],+e[2],+e[3]],s=[+t[1],+t[2],+t[3]],i=0,_.each(o,function(e,t){i+=(o[t]-s[t])*(o[t]-s[t])}),Math.sqrt(i)<50)&&(t[1]=+t[1]+(30<+t[1]?-30:30),t[2]=+t[2]+(30<+t[2]?-30:30),t[3]=+t[3]+(30<+t[3]?-30:30),t="rgba("+t[1]+","+t[2]+","+t[3]+",1)",a.css("color",t))},500),t.prototype.parseXFBML=_.throttle(function(){peepso.util.fbParseXFBML()},2e3),e=jQuery,window.activity=new t,e(function(){activity.remove_broken_thumbnails(),activity.init()})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./datetime":3}],2:[function(e,t,o){!function(t){!function(){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e,n=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e};function r(e,t,o){(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o}const p=["January","February","March","April","May","June","July","August","September","October","November","December"];const m=(e,t)=>{return new Date(e,t,0).getDate()},s=e=>{e=e.split("-");return new Date(+e[0],+e[1]-1,+e[2])},i=e=>{var t=e.getFullYear(),o=e.getMonth()+1,e=e.getDate();return[t,(o<10?"0":"")+o,(e<10?"0":"")+e].join("-")};o.default=class{constructor(e,t,o){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=(r(this,"$year",void 0),r(this,"$month",void 0),r(this,"$date",void 0),r(this,"opts",void 0),new Date),a=i.getFullYear(),i={monthNames:p,defaultDate:new Date(i.getTime()),minDate:new Date(a-80,0,1,1,0,0),maxDate:new Date(a+80,11,31,1,0,0),onSelect:()=>{}};this.opts=n.default.extend(i,s),this.$year=(0,n.default)(e).on("change",e=>this.onChangeYear(e)),this.$month=(0,n.default)(t).on("change",e=>this.onChangeMonth(e)),this.$date=(0,n.default)(o).on("change",()=>this.onChangeDate()),this.populateYear(),this.populateMonth(+this.$year.val()),this.populateDate(+this.$year.val(),+this.$month.val())}getDate(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=+this.$date.val(),o=+this.$month.val(),s=+this.$year.val();return e?`${t} ${p[o-1]} `+s:i(new Date(s,o-1,t))}setDate(e){var t=(e="string"==typeof e?s(e):e).getDate(),o=e.getMonth()+1,e=e.getFullYear();this.populateYear(e),this.populateMonth(e,o),this.populateDate(e,o,t)}populateYear(e){let{minDate:t,maxDate:o,defaultDate:s}=this.opts,i=t.getFullYear(),a=o.getFullYear(),n="";for(e=e||s.getFullYear();i<=a;i++)n+=`<option value="${i}"${i===e?' selected="selected"':""}>${i}</option>`;this.$year.html(n)}populateMonth(e,t){let{minDate:o,maxDate:s,defaultDate:i,monthNames:a}=this.opts,n=o.getFullYear(),r=s.getFullYear(),p=n<e?1:o.getMonth()+1,c=e<r?12:s.getMonth()+1,d="";for(t=t||+this.$month.val()||i.getMonth()+1;p<=c;p++)d+=`<option value="${p}"${p===t?' selected="selected"':""}>${a[p-1]}</option>`;this.$month.html(d)}populateDate(e,t,o){let{minDate:s,maxDate:i,defaultDate:a}=this.opts,n=s.getFullYear(),r=i.getFullYear(),p=s.getMonth()+1,c=i.getMonth()+1,d=n<e||p<t?1:s.getDate(),u=e<r||t<c?m(e,t):i.getDate(),l="";for(o=o||((o=+this.$date.val())?Math.min(o,u):a.getDate());d<=u;d++)l+=`<option value="${d}"${d===o?' selected="selected"':""}>${d}</option>`;this.$date.html(l)}onChangeYear(e){e=+e.target.value;this.populateMonth(e),this.$month.triggerHandler("change")}onChangeMonth(e){var t=+this.$year.val(),e=+e.target.value;this.populateDate(t,e),this.$date.triggerHandler("change")}onChangeDate(){this.opts.onSelect(this.getDate())}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),Object.defineProperty(o,"DateSelector",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(o,"TimeSelector",{enumerable:!0,get:function(){return i.default}});var s=a(e("./date-selector")),i=a(e("./time-selector"));function a(e){return e&&e.__esModule?e:{default:e}}},{"./date-selector":2,"./time-selector":4}],4:[function(e,t,o){!function(t){!function(){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e,i=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e};function a(e,t,o){(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o}const s=(e,t)=>e="PM"!==t.toUpperCase()?12===e?0:e:12===e?12:e+12,n=e=>{let t;return{hour:e=e<12?(t="AM",0===e?12:e):(t="PM",12===e?12:e-12),ampm:t}};o.default=class{constructor(e,t,o,s){a(this,"$hour",void 0),a(this,"$minute",void 0),a(this,"$ampm",void 0),a(this,"opts",void 0),a(this,"isAmpm",void 0);this.isAmpm=!(!o||!o.nodeType),this.opts=i.default.extend({am:"AM",pm:"PM",step:15,onSelect:()=>{}},(this.isAmpm?s:o)||{}),this.$hour=(0,i.default)(e).on("change",()=>this.onChangeHour()),this.$minute=(0,i.default)(t).on("change",()=>this.onChangeMinute()),this.isAmpm&&(this.$ampm=(0,i.default)(o).on("change",()=>this.onChangeAmpm())),this.populateHour(),this.populateMinute(),this.populateAmpm()}getTime(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];let t=+this.$hour.val(),o=+this.$minute.val();return e?(t<10?"0":"")+t+":"+(o<10?"0":"")+o+(this.isAmpm?" "+this.$ampm.val().toUpperCase():""):((t=this.isAmpm?s(t,this.$ampm.val()):t)<10?"0":"")+t+":"+(o<10?"0":"")+o}setTime(e){let[t,o]=e.split(":");t=+t,this.isAmpm?(t=n(t),this.$ampm.val(t.ampm),this.$hour.val(t.hour)):this.$hour.val(t),o=Math.min(59,Math.max(0,+o)),o-=o%this.opts.step,this.$minute.val(o)}populateHour(e){let t=this.isAmpm?1:0,o=this.isAmpm?12:23,s="";for(;t<=o;t++)s+=`<option value="${t}"${t===e?' selected="selected"':""}>${t<10?"0":""}${t}</option>`;this.$hour.html(s)}populateMinute(e){let t=0,o="";for(;t<=59;t+=this.opts.step)o+=`<option value="${t}"${t===e?' selected="selected"':""}>${t<10?"0":""}${t}</option>`;this.$minute.html(o)}populateAmpm(s){if(this.isAmpm){let t=[{value:"AM",label:this.opts.am},{value:"PM",label:this.opts.pm}],o="";for(let e=0;e<t.length;e++)o+=`<option value="${t[e].value}"${t[e].value===s?' selected="selected"':""}>${t[e].label||t[e].value}</option>`;this.$ampm.html(o)}}onChangeHour(){this.opts.onSelect(this.getTime())}onChangeMinute(){this.opts.onSelect(this.getTime())}onChangeAmpm(){this.opts.onSelect(this.getTime())}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);