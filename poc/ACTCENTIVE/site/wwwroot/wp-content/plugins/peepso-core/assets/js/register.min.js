!function(d){peepsodata.register&&peepsodata.register.confirm_email_field;function s(e){var t,i,a,r,n,s,o,p=d(e),e=p.find("input[type=text],input[type=email],input[type=password],input[type=checkbox],input[type=radio],textarea,select");if(e.length)return t=e.eq(0).data("id"),i=e.eq(0).attr("name")||"",r="checkbox"===(a=(e.eq(0).attr("type")||"").toLowerCase())?(r=e.filter(":checked").map(function(){return this.value}),r=d.makeArray(r),JSON.stringify(r)):"radio"===a?e.filter(":checked").val():e.hasClass("datepicker")?e.data("value"):peepso.observer.applyFilters("profile_field_save",e.val(),e),0<=["username","email","email_verify","password","password2","terms","privacy","g-recaptcha-response"].indexOf(i)?(n=!0,s=peepsodata.ajaxurl_legacy+"profilefieldsajax.validate_register",(o={}).name=i,o[i]=r,"email_verify"===i?(e=e.closest("form.ps-js-form-register").find("[name=email]"),o.email=e.val()):"password2"===i&&(e=e.closest("form.ps-js-form-register").find("[name=password]"),o.password=e.val())):(n=!1,s=peepsodata.ajaxurl_legacy+"profilefieldsajax.validate",o={user_id:peepsodata.currentuserid,view_user_id:peepsodata.userid,id:t,value:r}),d.Deferred(function(a){d.ajax({url:s,type:"post",dataType:"json",data:o}).always(function(e){var t,i=p.find(".ps-form__error");(e=e.responseJSON?e.responseJSON:e).errors&&e.errors.length?(i.empty(),t=n?e.errors:e.errors[0],_.each(t,function(e){i.append('<div class="ps-form__error-item">'+e+"</div>")}),i.show()):i.hide(),a.resolve.apply(null,arguments)})})}var e=d(document).find("form.ps-js-form-register"),t=(e.on("input","input[type=text]:not(.ps-js-field-location),input[type=email],input[type=password],textarea",_.debounce(function(e){s(d(e.target).closest(".ps-form__field"))},500)).on("click","input[type=checkbox],input[type=radio]",_.debounce(function(e){s(d(e.target).closest(".ps-form__field"))},100)).on("change","select",_.debounce(function(e){s(d(e.target).closest(".ps-form__field"))},100)).on("submit.ps-register",function(e){var t,i,a,r,n;return e.preventDefault(),e.stopPropagation(),t=d(this),i=t.find(".ps-form__field"),a=i.find("input.datepicker"),r=t.find("button[type=submit]"),n=[],t.data("ps-submitting")||(t.data("ps-submitting",!0),r.attr("disabled","disabled"),i.each(function(){var e=s(this);e&&n.push(e)}),r.find("img").show(),d.when.apply(d,n).done(function(){for(var e in r.find("img").hide(),arguments)if(arguments[e][0].errors)return t.removeData("ps-submitting"),void r.removeAttr("disabled");a.length&&a.each(function(){var e=d(this),t=e.data("value");t&&($hidden=d('<input type="hidden" name="'+e.attr("name")+'" />'),e.removeAttr("name"),$hidden.insertAfter(e),$hidden.val(t))}),i.length&&i.each(function(){$input=d(this).find("input[type=text],input[type=email],input[type=password],input[type=checkbox],input[type=radio],textarea,select"),peepso.observer.doAction("profile_field_save_register",$input)}),setTimeout(function(){t.off("submit.ps-register"),r.removeAttr("disabled"),r.trigger("click"),r.attr("disabled","disabled")},100)})),!1}),e.find("input[name=username]")),i=e.find("input[name=email]"),a=("hidden"===t.attr("type")?i.on("input",function(){t.val(i.val())}):t.on("input",function(){var e=this.value.replace(/[^a-z0-9-_\.@]/gi,"");this.value!==e&&(this.value=e)}),e.find("input[name=terms], input[name=privacy]")),r=e.find("[type=submit]");a.length&&a.on("click.ps-register-consent",function(e){var t=[];a.each(function(){t.push(!!this.checked)}),0<=t.indexOf(!1)?(e.stopPropagation(),r.attr("disabled","disabled")):r.removeAttr("disabled")}).triggerHandler("click.ps-register-consent"),d(function(){setTimeout(function(){e.find(".ps-js-location-wrapper .ps-btn").on("mousedown",_.debounce(function(e){s(d(e.target).closest(".ps-form__field"))},100))},1e3)})}(jQuery);